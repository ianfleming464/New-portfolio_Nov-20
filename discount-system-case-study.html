<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Case Study · Discount Coordination Engine — Ian Fleming</title>

  <link rel="short icon" href="img/favicon-32x32.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>

  <!-- Simple top bar back link -->
  <header class="header" style="border-bottom:1px solid rgba(0,0,0,.06)">
    <div class="logo"><img src="img/Ian Fleming logo.png" alt=""/></div>
    <nav class="nav-inline">
      <a class="nav-inline__link" href="index.html#work"><i class="fas fa-arrow-left"></i> Back to My Work</a>
    </nav>
  </header>

  <!-- HERO -->
  <section class="case-hero">
    <div class="container">
      <h1 class="case-title">Custom Cart Discount Coordination Engine</h1>
      <p class="case-subtitle">Bridging Shopify’s cart/checkout logic to show trustworthy, combined discounts in the cart UI.</p>

      <div class="case-meta">
        <span class="pill">Role: Lead Developer</span>
        <span class="pill">Deployed to 8+ stores</span>
        <span class="pill">Stack: JS · Liquid · Rebuy · DOM</span>
      </div>
    </div>
  </section>

  <!-- OVERVIEW GRID -->
  <section class="case-grid container">
    <div class="case-main">
      <h2>Summary</h2>
      <p>
        Shopify applies <em>automatic</em> discounts at checkout and handles <em>manual</em> codes at the cart layer. The two don’t natively combine in the cart, leading to confusing subtotals and lost trust. I built a modular cart-layer system that detects both, allocates discounts proportionally, renders clear per-line price changes, and derives a truthful subtotal so the cart matches checkout expectations.
      </p>

      <div class="callout-note">
        <i class="fas fa-lock"></i>
        Client code is private. This case study documents architecture, approach, and redacted UI behaviour.
      </div>

      <h3>The Challenge</h3>
      <ul>
        <li>Automatic discounts exist only at checkout; manual codes affect cart UI.</li>
        <li>No native way to reflect them together pre-checkout.</li>
        <li>Shopify splits/merges identical line items, breaking naïve grouping logic.</li>
      </ul>

      <h3>Solution · Built in Stages</h3>
      <ol>
        <li><strong>Callbacks for line items</strong> – dynamic UI based on quantity/changes.</li>
        <li><strong>Free gift handler</strong> – reads MOV/code/gift from admin; adds/removes safely.</li>
        <li><strong>Manual code UI</strong> – compare-at + sale classes; transparent pricing.</li>
        <li><strong>Proportional allocation</strong> – fixed/% spread so subtotal is always accurate.</li>
        <li><strong>URL discount sync</strong> – detects Shopify’s <code>discount_code</code> cookie; applies same UI updates.</li>
        <li><strong>3-for-2 handler</strong> – cheapest eligible item goes to zero; visuals + math stay in sync.</li>
        <li><strong>Auto-discount detection</strong> – listens for platform signals; mirrors expected checkout math in cart.</li>
        <li><strong>Derived subtotal</strong> – sums effective per-line sale prices; overwrites displayed subtotal with guardrails.</li>
        <li><strong>Combination logic</strong> – manual + auto together with coherent UI and totals.</li>
        <li><strong>Split/merge resilience</strong> – defensive regrouping; fails-safe to native display when needed.</li>
        <li><strong>Event Manager → Coordinator</strong> – migrating to a single orchestrator (queue + debounce) for clean sequencing.</li>
        <li><strong>State preservation</strong> – quick, safe reversion when codes/conditions change.</li>
      </ol>

      <h3>Architecture (high level)</h3>
      <ul class="bullets-tight">
        <li><code>callbacks/</code> – DOM mutations for price/badge/subtotal.</li>
        <li><code>handlers/</code> – free gifts, 3-for-2, code presence, auto-discount signals.</li>
        <li><code>utils/</code> – logging, cookies, debouncing, selectors, currency.</li>
        <li><code>eventManager</code> → <code>discountCoordinator</code> – orchestrate updates deterministically.</li>
      </ul>

      <h3>Impact</h3>
      <ul>
        <li>Clear, truthful cart totals → fewer discount-related support tickets.</li>
        <li>Marketing links show correct prices pre-checkout → improved trust.</li>
        <li>Deployed across multiple international storefronts; configurable per region.</li>
      </ul>

      <h3>What I’d Do Next</h3>
      <ul>
        <li>Finish Coordinator refactor; extract allocation/formatting into reusable utils.</li>
        <li>Add configurable selectors so it’s Rebuy-aware, not Rebuy-locked.</li>
        <li>Companion Shopify Function (TS/Wasm) to enforce rules at checkout where needed.</li>
      </ul>

      <div class="project-links" style="margin-top:1.25rem">
        <a href="https://github.com/yourusername/discount-system-docs" class="btn">Technical Docs</a>
        <a href="files/Ian Fleming Resume 2025.pdf" class="btn btn--ghost" target="_blank">Download Resume</a>
        <a href="index.html#work" class="btn btn--ghost">Back to Work</a>
      </div>
    </div>

    <!-- SIDE META -->
    <aside class="case-side">
      <div class="side-card">
        <h4>Role & Scope</h4>
        <ul class="bullets-tight">
          <li>Lead developer</li>
          <li>Frontend JS + cart UX</li>
          <li>Rebuy integration</li>
          <li>Theme/Liquid work</li>
        </ul>
      </div>

      <div class="side-card">
        <h4>Stack</h4>
        <ul class="bullets-tight">
          <li>JavaScript (ES6+)</li>
          <li>Liquid · DOM APIs</li>
          <li>Rebuy Smart Cart</li>
          <li>Metafields, cookies</li>
        </ul>
      </div>

      <div class="side-card">
        <h4>Constraints</h4>
        <p class="small">
          Shopify line-item split/merge can disrupt grouping for multi-quantity edge cases.
          UI fails-safe to native behaviour; enforcement belongs to checkout Functions.
        </p>
      </div>
    </aside>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <a href="mailto:ianflemingdeveloper@gmail.com" class="footer__link">ianflemingdeveloper@gmail.com</a>
    <ul class="social-list">
      <li class="social-list__item"><a class="social-list__link" href="https://github.com/ianfleming464/" target="_blank"><i class="fab fa-github"></i></a></li>
      <li class="social-list__item"><a class="social-list__link" href="https://www.linkedin.com/in/i-fleming/" target="_blank"><i class="fab fa-linkedin"></i></a></li>
    </ul>
  </footer>

</body>
</html>
